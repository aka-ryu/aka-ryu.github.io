---
layout: post
title: NEXTJS - 이미지 사이즈, 확장자, 로딩속도
categories: NEXTJS
---

# 개요
개발할때는 몰랐는데 실제 배포 후 특정 큰 이미지들이 로딩하는데 오래걸려 UX를 저하시키는 현상이 있었다.

# Next.js 이미지 처리: 자동 WebP 변환 및 크기 제한

Next.js에서 `next/image` 컴포넌트를 사용할 때, 이미지가 자동으로 최적화되며 WebP로 변환되는 점과 관련하여 동작 방식을 정리한 문서입니다. 특히, 큰 이미지 처리에서 로컬 환경과 프로덕션 환경의 차이도 다룹니다.

---

## **1. 이미지 자동 WebP 변환**

Next.js는 `next/image` 컴포넌트를 통해 이미지 최적화를 자동으로 수행합니다. 이 과정에서 **WebP**와 같은 최신 이미지 포맷으로 변환하여 브라우저와 사용자 환경에 적합한 이미지를 제공합니다.

### **작동 방식**
- 브라우저가 WebP를 지원하면, Next.js는 자동으로 WebP로 변환된 이미지를 제공합니다.
- WebP는 파일 크기를 줄이고 로딩 시간을 단축하기 위해 사용됩니다.
- 브라우저가 WebP를 지원하지 않는 경우에는 원본 포맷(PNG, JPEG 등)이 제공됩니다.

### **장점**
- 이미지 파일 크기 감소로 인해 페이지 로딩 속도가 빨라짐.
- SEO 및 사용자 경험(UX) 향상.
- 최신 브라우저 최적화 기능 활용.

---

## **2. 너무 큰 이미지는 변환하지 못함**

Next.js는 서버 측에서 이미지를 최적화하지만, **너무 큰 이미지**는 처리하지 못하고 원본 포맷으로 전달될 수 있습니다.  
이는 서버 메모리 및 이미지 처리 제한 때문입니다.

### **제한 사항**
1. **크기 제한**:
   - WebP로 변환 가능한 최대 해상도는 16383px × 16383px입니다. 이를 초과하는 이미지는 변환할 수 없습니다.
2. **파일 크기**:
   - Next.js의 이미지 최적화 서버는 지나치게 큰 이미지 파일을 변환하지 않을 수 있습니다.
3. **메모리 사용**:
   - 서버 환경에서 메모리가 부족하면 이미지 최적화가 실패할 수 있습니다.

---

## **3. 로컬 환경과 프로덕션 환경 차이**

### **로컬 환경**
- 로컬 개발 서버에서는 Next.js가 이미지를 더 유연하게 처리합니다.
- 큰 이미지도 WebP로 변환될 수 있습니다. 이는 로컬 환경에서 성능 제한이 느슨하게 적용되기 때문입니다.

### **프로덕션 환경**
- 프로덕션 환경에서는 서버 리소스를 효율적으로 관리하기 위해 **이미지 크기 제한**이 엄격하게 적용됩니다.
- 너무 큰 이미지는 변환되지 않고 원본 포맷(PNG, JPEG)으로 제공됩니다.

---

## **4. 해결 방법**

1. **이미지 사전 최적화**:
   - PNG나 JPEG 파일을 WebP 또는 AVIF로 변환한 후 업로드.
   - [TinyPNG](https://tinypng.com/) 또는 `pngquant` 같은 도구를 사용하여 파일 크기 줄이기.

2. **Next.js 설정 조정**:
   - `next.config.js`에서 이미지 최적화 관련 설정을 조정하여 크기 제한을 완화하거나, 필요한 경우 최적화를 비활성화.
   ```javascript
   module.exports = {
     images: {
       deviceSizes: [640, 750, 1080, 1920, 2048, 3840], // 허용되는 디바이스 크기
       imageSizes: [16, 32, 48, 64, 96, 128, 256, 384], // 최적화 이미지 크기
       formats: ['image/avif', 'image/webp'], // AVIF 및 WebP로 변환
     },
   };
