---
layout: post
title: AWS - ELB 드레이닝
categories: AWS
---
## 로드밸런서 드레이닝(Draining)이란?

AWS에서 로드밸런서를 사용할 때, EC2 인스턴스를 제거하려고 하면
기존에 처리 중이던 요청들을 **갑자기 끊지 않고**, **마무리할 시간을 주는 기능**이다.

이게 바로 드레이닝이다.

---

## 왜 필요한가?

```
[사용자] → [로드밸런서] → [EC2 인스턴스]
                         ↑
                  갑자기 끊으면?
```

* 사용자 연결이 **강제 종료**됨
* 다운로드/결제/업로드 중이라면 **문제 발생**
* 사용자 경험 **나빠짐**

그래서 EC2를 제거할 때, 기존 연결은 **살려두고**,
새 요청만 안 받게 하는 방식이 필요함 → 그게 Draining이다.

---

## 작동 흐름

1. EC2를 대상 그룹에서 제거 (Deregister)
2. 해당 인스턴스는 **새로운 요청은 안 받음**
3. 기존 연결된 요청은 **설정된 시간까지 유지됨**
4. 시간이 지나면 인스턴스를 완전히 제거

---

## 기본 대기 시간

* 기본: **300초 (5분)**
* 설정 가능: 0 \~ 3600초 (1시간)

**설정 위치:**

* 대상 그룹(Target Group) > 등록 해제 지연 시간(Deregistration delay)

---

## 이런 상황에서 유용함

* 롤링 배포
* Auto Scaling 축소
* 무중단 배포 (Blue/Green)
* EC2 점검, 재시작

---

## 요약

| 항목     | 설명                                   |
| ------ | ------------------------------------ |
| 정의     | EC2 인스턴스를 빼면서 기존 요청은 끝까지 처리하게 해주는 기능 |
| 디폴트 시간 | 300초                                 |
| 설정 위치  | Target Group > Deregistration delay  |
| 장점     | 무중단 배포, 사용자 연결 보호, 부드러운 제거           |

---

필수 개념은 아니지만, 운영단에서 굉장히 **중요한 실전 설정**이다.
