---
layout: post
title: AWS - 로드밸런서 Sticky Session
categories: AWS
---


## 스티키 세션 (Sticky Session) 이란?

로드밸런서를 쓰면 사용자의 요청이 여러 서버에 분산되는데,
**스티키 세션**을 설정하면 한 번 연결된 서버로 계속 요청을 보내게 만들 수 있다.

쉽게 말하면, "내가 처음 연결된 서버에 계속 붙어있게 하는 것"이다.

---

## 왜 필요할까?

일부 시스템은 **사용자 세션 정보**를 서버 메모리에 저장한다.

* 예: 로그인 상태, 장바구니 정보, 폼 입력 등

이런 경우 요청이 서버마다 왔다갔다 하면 세션이 꼬이거나 로그인이 풀릴 수 있다.
그래서 **세션을 유지하려면 한 서버에 계속 연결**돼야 한다.

---

## 동작 방식

### ✅ 예시 시나리오 (스티키 세션 X)

```
[사용자] → 로드밸런서 → 서버1
         → 로드밸런서 → 서버2 (다음 요청)
         → 로드밸런서 → 서버3 (그다음 요청)
→ 매번 서버가 바뀜 → 세션 불일치 가능
```

### ✅ 예시 시나리오 (스티키 세션 O)

```
[사용자] → 로드밸런서 → 서버2
         → 로드밸런서 → 서버2
         → 로드밸런서 → 서버2
→ 항상 같은 서버에 연결됨 → 세션 유지 안정
```

---

## 어떻게 구현돼?

### 방식 1: **쿠키 기반** (ALB의 경우 기본)

* 로드밸런서가 사용자의 브라우저에 **세션 쿠키**를 심는다.
* 이 쿠키를 통해 어떤 서버에 연결됐는지 추적해서 그 서버로 계속 보내줌.

### 방식 2: **IP 주소 기반** (단점 많음)

* 클라이언트 IP 기준으로 같은 서버에 매핑
* 문제: NAT, 프록시 환경에선 IP가 바뀌기도 함 → 예측 불가능

---

## 주의할 점

* 세션을 메모리가 아닌 **Redis, DB, 외부 세션 스토어**에 저장하면
  스티키 세션이 필요 없어짐 (어디서든 동일 세션 조회 가능)

* 서버 증설/축소 시에는 세션이 날아갈 수 있어서 **장기적인 세션 저장소 구성도 고려**해야 함

---

## 정리

* 스티키 세션은 사용자의 요청을 **항상 같은 서버로 보내는 기능**이다.
* 세션 유지가 필요한 서비스(로그인, 장바구니 등)에 유용하다.
* 하지만 확장성과 유지보수 측면에선 **외부 세션 저장소를 쓰는 게 더 좋을 수도 있다.**

> "세션에 민감한 서비스는 스티키 세션을 고려해야 하고,
> 스케일링을 생각하면 외부 저장소로 세션을 옮기는 게 맞다."
