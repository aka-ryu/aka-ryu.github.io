---
layout: post
title: AWS - 로드밸런서 NLB
categories: AWS
---
## NLB (Network Load Balancer) 정리

고성능 트래픽 분산을 위한 AWS의 L4 로드밸런서인 NLB에 대해 정리했다.

---

## ✅ NLB란?

> L4 (전송 계층)에서 작동하는 초고속 로드밸런서이다.
> TCP, UDP, TLS 기반 트래픽을 정적 IP로 빠르게 처리할 수 있다.

---

## ✅ NLB 주요 특징

| 항목          | 설명                 |
| ----------- | ------------------ |
| 계층          | L4 (TCP, UDP, TLS) |
| 성능          | 초당 수백만 요청 처리 가능    |
| 지연시간        | 매우 낮음 (마이크로초 수준)   |
| 정적 IP       | 지원 (Elastic IP 가능) |
| TLS 종료      | 가능 (옵션 기능)         |
| PrivateLink | 지원                 |

---

## ✅ 사용 사례

| 상황                  | 설명                   |
| ------------------- | -------------------- |
| 실시간 온라인 게임          | 빠른 응답, 낮은 지연, UDP 처리 |
| 영상/음성 통신 (WebRTC 등) | TCP/UDP 기반 실시간 스트리밍  |
| IoT 대량 연결           | 수십만 대 기기 연결 처리       |
| TLS Offload         | 인증서 처리 부하를 로드밸런서로 위임 |
| 고속 API Gateway      | 단순 TCP 서비스 처리        |

---

## ✅ ALB vs NLB

| 항목    | ALB               | NLB                |
| ----- | ----------------- | ------------------ |
| 계층    | L7 (HTTP/HTTPS)   | L4 (TCP/UDP)       |
| 성능    | 보통                | 매우 높음              |
| 속도    | 상대적으로 느림          | 매우 빠름              |
| 정적 IP | 불가 (Alias만 지원)    | 가능 (EIP 지원)        |
| 라우팅   | URL/호스트 기반 정교한 분기 | 불가 (포트 기준만 가능)     |
| 사용 예시 | 웹페이지/API 서버       | 게임서버, 영상통신, 고속 TCP |

---

## ✅ NLB를 사용하는 이유

* 초고속 트래픽 수용이 필요할 때
* TCP/UDP 계열 트래픽을 다뤄야 할 때
* ALB로는 감당이 안 될 정도의 부하가 있을 때
* 정적 IP가 반드시 필요한 상황일 때

---

## ✅ ALB로 감당 안 되는 경우 NLB 고려

ALB는 기능이 강력하지만 성능이 한계에 도달하면:

* ALB 지연 / 타임아웃 / 502 에러가 자주 발생
* 초고속 응답 처리에 병목 발생
* WebSocket/HTTP3 등 특수 상황에 제한

이럴 땐 NLB로 전환하거나 병행 구조로 구성한다.

---

## ✅ NLB와 ALB를 함께 사용하는 전략

### 전략 1: NLB 앞단 + ALB 뒷단 구조

```
[ Client ]
     │
     ▼
 ┌────────┐
 │  NLB   │ ← 초고속 입구 (정적 IP)
 └────────┘
     │
     ▼
 ┌────────┐
 │  ALB   │ ← HTTP 라우팅 (/api, /admin 등)
 └────────┘
     │
     ▼
 [ EC2 / ECS ]
```

* ALB는 HTTP 경로 처리, 인증, 쿠키 담당
* NLB는 퍼블릭 IP 또는 PrivateLink 용도로 앞단 구성

### 전략 2: 트래픽 성격별 분기 구조

```
[ Client ]
    │
    ├─> [ ALB ] → 프론트/백엔드 웹 API 처리
    │
    └─> [ NLB ] → 게임 서버, WebRTC, TCP/UDP 처리
```

* 웹은 ALB, 실시간 통신/저지연 트래픽은 NLB로 분리

---

## ✅ 정리

| 상황               | 선택 기준                |
| ---------------- | -------------------- |
| 기능 중심, 경로 분기 필요  | ALB                  |
| 속도 중심, 트래픽 대량 처리 | NLB                  |
| 둘 다 필요           | 병행 전략 구성 (ALB + NLB) |

ALB는 똑똑하고 유연한 L7, NLB는 빠르고 단순한 L4.
서비스 성격에 맞게 조합하면 탄탄한 인프라가 된다.
