---
layout: post
title: AWS - ROUTE53 멀티 리전 트래픽 라우팅
categories: AWS
---



## 전체적인 흐름과 개념

Route 53은 DNS 서비스지만, 단순 DNS가 아니라 **글로벌 트래픽 매니저(로드밸런서 비슷)** 역할을 수행할 수 있다.
여러 리전에 ALB와 EC2를 배포하고, Route 53 정책(지연시간, 위치, 가중치 등)을 활용하면 사용자 요청을 전세계적으로 최적의 리전으로 분산할 수 있다.

---

## 아키텍처 도식

```
      [사용자]
         |
         v
+-----------------+
|    Route 53     |
|   (DNS + 정책)   |
+-----------------+
   |     |       |
   |     |       |
   v     v       v
 ALB-A  ALB-B  ALB-C
   |     |       |
 EC2-A  EC2-B  EC2-C
```

1. 사용자가 `api.example.com`을 요청.
2. **TTL이 짧으면** 매 요청 시 DNS 재조회가 발생할 때 **다른 리전의 ALB로 IP를 반환**할 수 있음.
3. 각 리전의 ALB는 Target Group 내 EC2로 트래픽을 내부 분산.

---

## Route 53 라우팅 정책

### 1. 지연시간 기반 라우팅 (Latency Routing)

* 사용자의 위치에서 **지연시간이 가장 낮은 리전**의 ALB를 선택.
* 글로벌 서비스 속도 최적화에 많이 활용.

### 2. 위치 기반 라우팅 (Geo Routing)

* 사용자 국가/대륙에 따라 특정 리전으로 트래픽 유도.
* 규제나 데이터 주권 대응에 유용.

### 3. 가중치 라우팅 (Weighted Routing)

* 예: A 50%, B 30%, C 20% 비율로 트래픽 분산.
* 카나리 배포나 점진 전환용.

### 4. Failover 라우팅

* Active-Passive 구조.
* 메인 리전 장애 시 백업 리전으로 자동 전환.

---

## TTL과 와따리가따리 현상

* **TTL 짧게 (30\~60초)** → 사용자가 같은 도메인을 여러 번 조회 시 **다른 리전 ALB를 오갈 수 있음.**
* **세션 중요 X** → 문제 없음.
* **세션 필요 O** → Redis 등 세션 스토리지 공유나 무상태 아키텍처 필요.

---

## Route 53 vs ELB 차이

* **Route 53**

  * 글로벌 DNS 트래픽 매니저.
  * 어떤 리전의 ALB를 선택할지 결정.

* **ELB(ALB/NLB)**

  * 리전 내부 Target Group으로 로드밸런싱.

즉, **Route 53 = 글로벌 라우팅, ELB = 리전 내부 분산**.

---

## 예시 시나리오

1. **멀티리전 서비스**

   * 서울, 도쿄, 미국 리전에 ALB/EC2 배포.
   * Route 53 Latency Routing으로 사용자 근접 리전 선택.

2. **Failover 시나리오**

   * 메인 리전(서울) 장애 시 미국 리전으로 트래픽 전환.

3. **TTL 기반 라운드로빈 효과**

   * TTL이 짧으면 사용자 요청이 A, B, C 리전을 번갈아가며 갈 수 있음.

---

## 요약

* Route 53은 **DNS 기반 글로벌 로드밸런서**로, 위치/지연시간/가중치/Failover 정책을 지원.
* TTL이 짧으면 유저가 다른 리전으로 쉽게 라우팅될 수 있다.
* 세션 유지가 필요 없다면 큰 문제 없이 와따리가따리 구조 사용 가능.
* ELB는 **리전 내부 분산**만 담당.
