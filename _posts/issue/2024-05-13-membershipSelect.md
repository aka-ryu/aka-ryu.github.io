---
layout: post
title: ISSUE - 회원권 조회 이슈
category: ISSUE
---

## 개요

회원권을 기준으로 유저의 이용권한을 확인하는데 이때 회원권을 제대로 인식하지 못하여 서비스이용을 제대로 하지 못하는 케이스가 발생하였다.

## 원인

크게 2가지의 이유가 존재하였는데,

1. 서비스, 통합회원, 처머스 서버간의 불필요한 콜플로우
2. 서비스의 ec2의 스케일이 너무 작음(t3) - [트래픽이슈](/issue/2024/05/13/traffic.html) 관련

## 해결방안

결론적으로 서버의 성능이 떨어지는 상태에서 부하가 걸려 제대로 처리하지 못하는 이슈였다.  
서버의 스케일업의 경우 내 권한 밖이기 때문에 로직단에서 불필요한 콜플로우 제거 및 최적화를 진행 하였고 변경전과 변경후는 다음과 같다.

### 변경전

![scrennsh](/public/img/20240513_185246.png)

1. 초코 -> 커머스 요청 (이용권요청)
2. 커머스 -> 초코 요청 (토큰검증 및 유저정보 요청)
3. 초코 -> 통합회원 요청 (유저정보 요청)
4. 2번에 대한 응답
5. 1번에 대한 응답

**3번의 유저정보를 먼저 들고있을 경우 2번 요청을 생략할수 있음으로 해당 콜플로우를 다음과 같이 수정하였다**

### 변경후

![scrennsh](/public/img/20240513_191028.png)

위의 게시한 대로 3번을 먼저 요청하여 2번 요청을 생략하였고 이후 ec2 의 스케일업도 진행하여 해당이슈는 종료되었다.

(구상 후 직접 개발,수정 하였음)
