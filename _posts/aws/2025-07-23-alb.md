---
layout: post
title: AWS - 로드밸런서 ALB
categories: AWS
---
## ALB (Application Load Balancer)

AWS에서 ALB는 L7 애플리케이션 계층에서 작동하는 로드밸런서다.
단순히 서버 분산만 하는 게 아니라, 경로, 도메인, 헤더 같은 조건에 따라 똑똑하게 라우팅할 수 있다.

---

## ✅ ALB 기본 개념

* L7(애플리케이션 레벨)에서 작동함 → HTTP/HTTPS 요청 기반
* 경로나 도메인, 헤더, 쿼리 조건으로 분기 가능
* EC2, Lambda, Fargate 등으로 트래픽 보낼 수 있음

---

## ✅ 주요 기능

| 기능                   | 설명                                       |
| -------------------- | ---------------------------------------- |
| 경로 기반 라우팅            | 예: /api/\* → 백엔드 서버, /static/\* → 프론트 서버 |
| 호스트 기반 라우팅           | 예: api.example.com → API 서버              |
| 헤더/쿼리 조건 분기          | 헤더, 쿼리 문자열로 세밀한 조건 설정 가능                 |
| HTTPS 종료             | HTTPS는 ALB에서 처리하고 백엔드는 HTTP로 운영 가능       |
| 고정 응답 / 리디렉션         | 요청에 대해 바로 301 리디렉션 또는 403 고정 응답 가능       |
| WebSocket, HTTP/2 지원 | 실시간 통신도 커버 가능                            |

---

## ✅ 규칙(Rule) 커스터마이징

ALB는 Listener Rule이라는 걸 통해 조건과 액션을 조합해서 요청을 처리한다.

### 조건(Condition) 종류

* `Path` : URL 경로 기반 (`/api/*`, `/admin/*` 등)
* `Host` : 도메인 기반 (`admin.example.com` 등)
* `Header`, `Query string`, `Method`, `Source IP` 등

### 액션(Action) 종류

* `Forward` : 특정 Target Group으로 전달
* `Redirect` : 리디렉션 처리 (HTTP→HTTPS 등)
* `Fixed Response` : 바로 상태코드+메시지 반환
* `Authenticate` : Cognito나 OIDC로 로그인 유도

---

## 🧪 사용 예시

### 1. 프론트/백 분리 구조

```
사용자 → ALB →
  ├ /api/* → NestJS API 서버
  └ / → Next.js 프론트 서버
```

### 2. 서브도메인 분기

```
사용자 → ALB →
  ├ api.example.com → 백엔드 API
  ├ admin.example.com → 관리자 서버
  └ www.example.com → 사용자 웹사이트
```

### 3. HTTPS 리디렉션

```
조건: HTTP 요청일 때
액션: HTTPS로 301 Redirect
```

### 4. 고정 응답 처리

```
조건: path == /beta
액션: Fixed Response 403, "준비 중입니다."
```

### 5. 무거운 요청 따로 분기

```
조건: path == /report
액션: Forward to 고성능 EC2 전용 Target Group
```

---

## 📊 아키텍처 도식화 예시

```
                [ 사용자 ]
                    │
                 (HTTPS)
                    │
              ┌────────────┐
              │    ALB     │  ← HTTPS 종료, 조건 판단
              └────────────┘
              │           │
          경로: /api    경로: /static
              │           │
        ┌─────┴─────┐  ┌──┴───────┐
        │  API 서버  │  │ 프론트 서버 │
        └───────────┘  └──────────┘
```

---

## ✅ 마무리 요약

* ALB는 단순 분산기가 아니라 **조건에 따라 라우팅하는 스마트한 분기기**다
* 경로, 도메인, 헤더, 쿼리 등으로 라우팅 세밀화 가능
* 고정 응답, 인증 처리, 리디렉션 등 다양한 기능 지원
* 프론트/백 완전 분리형 구조, 마이크로서비스 구조에 매우 적합하다
