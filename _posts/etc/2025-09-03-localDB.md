---


layout: post
title: ETC - EC2에서 로컬 PC PostgreSQL 연결 플로우
categories: ETC
---

# AWS EC2에서 로컬 PC PostgreSQL 연결하기

개발 및 테스트 목적으로 EC2에서 로컬 PC에 설치된 PostgreSQL로 연결할 필요가 있었다.
이 과정에서 공유기 설정, PostgreSQL 설정, PC 방화벽 설정 등 여러 단계를 거쳐 연결을 완성한 내용을 정리한다.

---

## ✅ 환경

* **EC2 인스턴스**: 애플리케이션 서버
* **로컬 PC**: PostgreSQL 설치 및 데이터베이스 운영
* 연결 방식: 퍼블릭 IP + 포트 포워딩 + 방화벽 허용
* EC2에서 로컬 PC의 PostgreSQL에 직접 접속

---

## 1. 공유기 설정 - 포트 포워딩

EC2에서 로컬 PC로 접속하려면 공유기에서 외부 접근용 포트를 열어야 한다.
포트 포워딩을 설정하여 외부 IP가 로컬 PC의 PostgreSQL로 연결될 수 있도록 했다.

### 설정 방법

1. 브라우저에서 공유기 관리자 페이지 접속

   * 일반적으로 `192.168.0.1` 또는 `192.168.1.1`이다
2. 로그인

   * 기본 계정: `admin/admin` 또는 공유기 라벨 참고
3. 메뉴에서 **포트 포워딩 / 가상 서버** 선택
4. 포트 포워딩 항목 추가

   * 서비스 이름: PostgreSQL
   * 내부 IP: 로컬 PC의 사설 IP
   * 외부 포트: 5432
   * 내부 포트: 5432
   * 프로토콜: TCP
5. 적용 후 저장

이 설정으로 EC2에서 공유기 퍼블릭 IP와 포트 5432로 접근하면 로컬 PC의 PostgreSQL에 연결된다.

---

## 2. PostgreSQL 설정

로컬 PC에서 PostgreSQL이 외부 연결을 허용하도록 설정을 변경했다.

### `postgresql.conf` 수정

```conf
listen_addresses = '*'
port = 5432
```

* 기본값은 `localhost`이므로 EC2에서 접근이 불가능했다
* 모든 IP를 허용하도록 `*`로 수정했다

### `pg_hba.conf` 수정

```conf
host    all             all             0.0.0.0/0               md5
```

* 모든 외부 IP에서 접근 가능하도록 허용했다
* 필요에 따라 EC2 퍼블릭 IP만 허용하도록 제한할 수도 있다

### PostgreSQL 재시작

```bash
sudo systemctl restart postgresql
```

---

## 3. PC 방화벽 설정

Windows 방화벽에서 포트 5432를 열어 PostgreSQL 접속을 허용했다.

1. 제어판 → 시스템 및 보안 → Windows Defender 방화벽 → 고급 설정
2. **인바운드 규칙** → 새 규칙

   * 포트 선택 → TCP → 5432 입력
   * 연결 허용 선택
   * 규칙 이름: PostgreSQL
3. 규칙 적용 후 저장

이렇게 설정하면 외부 EC2에서 로컬 PC PostgreSQL 포트로 연결이 가능하다.

---

## 4. EC2에서 연결 테스트

### `psql` 또는 애플리케이션에서 테스트

```bash
psql -h [공유기 퍼블릭 IP] -U [postgres 유저] -d [DB명] -p 5432
```

* 연결 성공 시 정상적으로 DB 접속 가능
* 실패 시 포트, 방화벽, PostgreSQL 설정 순서대로 점검한다

---

## 5. 문제 해결 과정 요약

* **연결 안 됨** → 포트 포워딩 또는 공유기 퍼블릭 IP 확인
* **Connection refused** → PostgreSQL `listen_addresses` 또는 `pg_hba.conf` 확인
* **접속 지연/차단** → PC 방화벽 확인
* 모든 단계 점검 후 EC2에서 정상 연결 확인

---

## 🧠 정리

1. 공유기에서 **포트 포워딩**을 통해 외부 접근용 포트를 열어야 한다
2. PostgreSQL 설정에서 **외부 IP 연결을 허용**하도록 `listen_addresses`와 `pg_hba.conf`를 수정해야 한다
3. PC 방화벽에서 **해당 포트를 허용**해야 EC2에서 접속 가능하다
4. 단계별 점검 순서는 **공유기 → PostgreSQL → 방화벽** 순으로 진행하면 문제를 빨리 해결할 수 있다

이 과정을 거치면 EC2에서 로컬 PC PostgreSQL에 안전하게 연결할 수 있다.
